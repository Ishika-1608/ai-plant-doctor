<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Plant Doctor | Professional</title>
    <!-- Importing Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e0f2f1 0%, #a5d6a7 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Glassmorphism Card */
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
            padding: 30px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        h1 { color: #1b5e20; margin-bottom: 5px; }
        p.subtitle { color: #558b2f; margin-bottom: 25px; font-size: 0.9rem; }

        /* Drag & Drop Area */
        .upload-area {
            border: 2px dashed #81c784;
            border-radius: 15px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: #fafafa;
        }

        .upload-area:hover, .upload-area.dragover {
            background: #f1f8e9;
            border-color: #43a047;
            transform: scale(1.02);
        }

        .upload-icon { font-size: 40px; color: #66bb6a; margin-bottom: 10px; }
        .upload-text { color: #777; font-size: 0.9rem; }

        /* Preview Image & Scanner Animation */
        .preview-container {
            display: none; /* Hidden by default */
            position: relative;
            width: 100%;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .preview-img { width: 100%; display: block; }

        /* The Scanning Line Animation */
        .scanner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: #00e676;
            box-shadow: 0 0 10px #00e676, 0 0 20px #00e676;
            animation: scan 1.5s infinite linear;
            display: none; /* Hidden unless analyzing */
            z-index: 10;
        }

        @keyframes scan {
            0% { top: 0; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, #43a047, #66bb6a);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            margin-top: 15px;
            transition: 0.3s;
            display: none; /* Hidden initially */
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }

        /* Result Section */
        .result-card {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            display: none;
            animation: slideUp 0.5s ease;
            text-align: left;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .disease-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 5px; }
        .confidence-score { font-size: 0.9rem; opacity: 0.8; margin-bottom: 10px; display: block; }
        
        /* NEW: Advice Box Styling */
        .advice-box {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
            font-size: 0.9rem;
            line-height: 1.5;
            color: #333;
        }
        .advice-box strong { color: #2e7d32; }

        .status-healthy { background: #e8f5e9; color: #2e7d32; border-left: 5px solid #4caf50; }
        .status-diseased { background: #fff8e1; color: #f57f17; border-left: 5px solid #ffc107; }
        .status-error { background: #ffebee; color: #c62828; border-left: 5px solid #ef5350; }

    </style>
</head>
<body>

<div class="card">
    <header>
        <h1>üåø AI Plant Doctor</h1>
        <p class="subtitle">Drag, Drop, and Diagnose</p>
    </header>

    <!-- Hidden Input -->
    <input type="file" id="fileInput" accept="image/*" style="display: none;">

    <!-- Upload Area (Visible initially) -->
    <div class="upload-area" id="dropZone">
        <div class="upload-icon">‚òÅÔ∏è</div>
        <div class="upload-text">Click or Drag image here</div>
    </div>

    <!-- Image Preview & Scanner (Hidden initially) -->
    <div class="preview-container" id="previewContainer">
        <img id="previewImg" class="preview-img" alt="Leaf Preview">
        <div class="scanner" id="scanner"></div>
    </div>

    <!-- Action Button -->
    <button id="analyzeBtn" class="btn">Start Analysis</button>

    <!-- Result Section -->
    <div id="resultCard" class="result-card">
        <div id="resultContent"></div>
    </div>
</div>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const previewContainer = document.getElementById('previewContainer');
    const previewImg = document.getElementById('previewImg');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const scanner = document.getElementById('scanner');
    const resultCard = document.getElementById('resultCard');
    const resultContent = document.getElementById('resultContent');

    let selectedFile = null;

    // --- Drag & Drop Interactions ---
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    dropZone.addEventListener('dragover', () => dropZone.classList.add('dragover'));
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', handleDrop);

    function handleDrop(e) {
        dropZone.classList.remove('dragover');
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
    }

    // --- Click Interactions ---
    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', function() {
        handleFiles(this.files);
    });

    function handleFiles(files) {
        if (files.length > 0) {
            selectedFile = files[0];
            
            // Show Preview
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                dropZone.style.display = 'none'; // Hide drop zone
                previewContainer.style.display = 'block'; // Show preview
                analyzeBtn.style.display = 'block'; // Show button
                resultCard.style.display = 'none'; // Hide old results
            };
            reader.readAsDataURL(selectedFile);
        }
    }

    // --- Analysis Logic ---
    analyzeBtn.addEventListener('click', async () => {
        if (!selectedFile) return;

        // UI State: Loading
        analyzeBtn.disabled = true;
        analyzeBtn.textContent = "Analyzing...";
        scanner.style.display = 'block'; // Start scanning animation
        resultCard.style.display = 'none';

        const formData = new FormData();
        formData.append('file', selectedFile);

        try {
            // Call Python API
            const response = await fetch('http://127.0.0.1:8000/predict', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error('Server error');

            const data = await response.json();
            displayResult(data);

        } catch (error) {
            showError("Could not connect to AI. Is the Python server running?");
        } finally {
            // UI State: Reset
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = "Analyze Again";
            scanner.style.display = 'none'; // Stop animation
        }
    });

    // UPDATED: Function to display results including Advice
    function displayResult(data) {
        const isHealthy = data.class.toLowerCase().includes('healthy');
        
        let cssClass = isHealthy ? 'status-healthy' : 'status-diseased';
        let emoji = isHealthy ? '‚úÖ' : '‚ö†Ô∏è';

        // Add the Advice text here
        resultContent.innerHTML = `
            <div class="disease-title">${emoji} ${data.class}</div>
            <span class="confidence-score">Confidence: <strong>${data.confidence.toFixed(1)}%</strong></span>
            
            <div class="advice-box">
                <strong>üíä Treatment Advice:</strong><br>
                ${data.advice}
            </div>
        `;

        resultCard.className = `result-card ${cssClass}`;
        resultCard.style.display = 'block';
    }

    function showError(msg) {
        resultContent.innerHTML = `<div style="color:red; font-weight:bold;">Error:</div> ${msg}`;
        resultCard.className = 'result-card status-error';
        resultCard.style.display = 'block';
    }
</script>

</body>
</html>